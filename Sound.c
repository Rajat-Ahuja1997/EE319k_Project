// Sound.c
// Runs on any computer
// Sound assets based off the original Space Invaders 
// Import these constants into your SpaceInvaders.c for sounds!
// Jonathan Valvano
// November 17, 2014
#include <stdint.h>
#include "DAC.h"
#include "tm4c123gh6pm.h"
void sound(void);
void (*PeriodicTask3)(void);
void DisableInterrupts(void); // Disable interrupts
void EnableInterrupts(void);  // Enable interrupts


uint32_t count = 0;

const unsigned char Laser[2304] = {8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,8,8,8,8,7,8,8,8,7,7,8,8,
	7,8,8,7,8,8,7,8,8,7,7,7,7,7,8,7,7,8,8,7,7,8,7,7,8,7,7,7,7,7,8,8,8,8,8,8,8,7,8,8,8,8,7,8,7,
	7,8,7,7,7,7,7,8,8,7,7,8,8,7,8,8,7,8,7,8,8,8,8,7,8,7,8,8,7,7,7,7,7,8,7,7,8,8,7,7,8,7,7,8,7,7,8,8,7,
	7,8,7,7,8,7,7,8,8,7,8,8,8,8,7,7,7,8,7,8,7,7,8,7,8,8,7,7,7,8,8,8,8,8,7,7,8,8,7,8,7,7,7,8,7,7,7,7,7,7,8,7,7,
	8,7,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,8,8,7,8,8,8,8,8,8,7,8,8,8,8,8,7,7,8,7,7,7,7,7,7,
	8,8,7,8,7,8,8,8,8,8,7,8,7,8,8,8,8,7,7,8,7,8,8,8,7,8,7,8,7,8,8,7,8,7,8,8,7,8,7,7,6,8,7,
	7,7,7,7,6,7,8,7,8,7,7,7,7,7,8,7,9,7,7,8,8,8,9,7,7,7,7,8,9,8,8,9,8,7,8,7,8,8,8,7,8,6,7,9,8,7,6,7,8,8,7,7,7,7,7,8,6,7,
	6,7,7,7,7,6,7,7,8,7,6,6,7,6,6,6,6,8,7,7,7,7,6,7,7,7,8,7,7,9,8,8,7,8,8,8,7,8,7	,9,8,8,7,6,6,6,6,8,8,
	7,6,6,7,6,7,7,8,7,8,8,8,7,8,9,8,7,7,8,7,7,8,7,8,9,7,6,6,8,8,6,5,7,6,8,7,8,8,7,7,8,8,7,6,6,8,7,7,6,8,6,
	7,9,6,6,8,6,7,7,7,7,7,6,7,7,7,8,7,7,8,9,7,7,9,9,8,7,8,7,10,4,8,7,8,6,8,7,
	7,7,8,7,7,9,7,6,7,7,6,5,8,6,6,6,9,7,6,9,5,7,8,6,7,8,8,6,8,8,7,8,9,7,8,9,5,8,8,7,6,7,
	7,9,9,6,8,9,8,7,8,6,8,6,9,6,8,9,5,9,6,7,7,5,9,6,9,6,8,8,6,9,6,8,6,8,6,8,6,9,6,7,9,5,9,6,9,7,9,7,8,9,7,9,6,8,6,8,4,9,5,8,
	6,6,8,6,6,6,8,5,8,6,7,7,8,7,8,6,9,6,8,7,9,6,8,6,10,5,9,8,7,8,8,7,9,6,10,7,7,8,6,9,5,8,8,7,9,7,9,8,6,8,6,9,6,8,6,6,8,6,9,4,9,7,6,8,7,8,5,
	8,9,5,8,8,6,10,6,6,9,5,7,9,7,6,9,4,8,9,5,9,9,5,9,9,5,9,6,7,11,6,7,9,6,6,9,5,6,10,7,7,9,7,6,9,6,7,8,5,7,10,6,7,9,
	6,7,9,7,6,9,7,7,10,7,6,10,7,5,9,8,6,7,8,7,8,9,7,6,9,7,6,8,7,6,8,8,6,8,8,8,9,7,5,8,9,6,5,9,8,5,6,9,8,5,7,9,6,
	5,8,9,5,6,9,9,6,5,8,9,5,5,9,9,6,6,9,9,5,5,8,8,5,5,8,9,6,6,9,9,5,5,9,9,5,5,9,10,7,5,7,9,8,5,7,10,9,6,6,9,9,7,5,8,11,9,4,
	6,9,10,7,5,7,9,8,6,7,10,9,6,6,9,9,7,6,7,10,9,6,5,7,10,9,7,6,6,8,8,6,6,7,8,7,6,7,9,8,6,6,8,10,8,6,5,8,9,8,6,5,7,9,8,5,
	5,7,10,9,6,5,7,9,9,7,6,6,8,10,9,7,5,7,10,10,7,5,6,8,10,9,6,6,7,8,8,7,6,6,8,9,8,6,5,6,8,10,9,7,4,6,8,10,8,6,5,7,8,9,9,7,6,6,8,
	10,10,7,5,6,8,9,9,8,7,6,7,9,10,9,7,6,6,7,9,10,9,6,5,6,8,10,9,7,6,6,7,8,9,8,6,5,6,8,9,8,7,6,6,7,9,10,9,7,6,6,7,8,8,
	8,7,7,6,7,8,8,8,7,6,7,7,8,8,8,7,7,7,8,8,8,8,7,7,6,7,8,9,8,7,6,6,6,8,9,9,8,7,6,6,7,8,9,9,8,7,7,7,8,9,8,8,
	7,6,6,7,8,9,8,7,6,6,6,8,9,9,8,7,6,6,7,8,9,9,9,7,6,6,6,7,8,9,9,8,7,6,6,7,8,9,9,8,7,6,6,6,7,8,8,8,8,7,6,6,7,7,8,8,8,8,7,7,7,7,
	8,8,8,8,7,7,7,7,7,8,9,9,8,7,6,6,6,7,8,9,9,8,8,7,6,6,7,8,9,9,8,8,7,6,6,7,8,8,9,9,8,7,6,6,6,7,8,8,8,8,7,7,6,6,7,7,8,8,8,8,7,6,
	6,6,7,8,8,9,8,8,7,6,6,6,7,8,9,9,8,8,7,6,6,6,7,8,8,8,8,8,7,7,7,7,8,8,8,8,8,7,7,7,7,8,8,8,8,8,7,7,7,7,7,7,8,8,8,8,8,7,6,6,6,7,8,8,
	9,9,8,8,7,7,6,7,7,7,8,8,8,8,8,7,7,6,6,7,7,8,8,8,8,8,7,7,7,7,7,7,8,8,8,8,8,7,7,7,7,7,7,7,8,8,8,8,8,8,7,7,6,6,7,7,8,8,8,8,8,8,7,7,6,7,
	7,7,8,8,8,8,8,8,7,7,7,7,7,7,8,8,8,8,8,8,7,7,7,7,7,7,7,8,8,8,8,8,8,7,7,7,7,7,7,8,8,8,8,8,8,7,7,7,6,7,7,7,8,8,8,8,8,8,7,7,7,7,7,7,
	7,8,8,8,8,8,8,8,7,7,7,7,7,7,7,8,8,8,8,8,8,7,7,7,7,7,7,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,8,8,8,8,8,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,8,8,8,8,8,8,7,7,7,7,
	7,7,7,7,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,8,8,
	8,8,8,8,8,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,8,8,
	8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,
	7,7,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,
	8,8,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,
	7,7,7,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,
	8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,
	8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,
	8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,7,8,7,
	8,7,7,7,7,7,7,7,7,7,7,7,7,8,8,7,8,8,7,8,8,7,8,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,7,8,8,8,8,8,8,8,7,8,8,8,8,8,8,8,8,8,8,8,7,8,8,8,8,8,8,
	8,8,8,8,8,8,8,8,8,7,8,8,8,8,8,8,8,8,7,7,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,7,8,7,7,7,8,8,8,8,7,7,7,
	7,7,7,7,7,7,7,7,7,7,8,7,8,7,7,8,8,7,8,8,8,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,
	8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,
	8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8};
	

	
void Timer3_Init(void(*task)(void), uint32_t period){
  SYSCTL_RCGCTIMER_R |= 0x08;   // 0) activate TIMER3
  PeriodicTask3 = task;          // user function
  TIMER3_CTL_R = 0x00000000;    // 1) disable TIMER3A during setup
  TIMER3_CFG_R = 0x00000000;    // 2) configure for 32-bit mode
  TIMER3_TAMR_R = 0x00000002;   // 3) configure for periodic mode, default down-count settings
  TIMER3_TAILR_R = period-1;    // 4) reload value
  TIMER3_TAPR_R = 0;            // 5) bus clock resolution
  TIMER3_ICR_R = 0x00000001;    // 6) clear TIMER1A timeout flag
  TIMER3_IMR_R = 0x00000001;    // 7) arm timeout interrupt
  NVIC_PRI5_R = (NVIC_PRI5_R&0xFFFF00FF)|0x00008000; // 8) priority 4
// interrupts enabled in the main program after all devices initialized
// vector number 37, interrupt number 21
  NVIC_EN0_R = 1<<25;           // 9) enable IRQ 25 in NVIC
  TIMER3_CTL_R = 0x00000001;    // 10) enable TIMER3A
}


void Timer3A_Handler(void){
	
	TIMER3_ICR_R = 0x00000001;// acknowledge TIMER1A timeout
  (*PeriodicTask3)(); // execute user task
}

void soundLaser(void){
	Timer3_Init(&sound, 3000000);	
}

void sound(void){
	
	count = (count+1)%2304;
	DAC_Out(Laser[count]);
	if(count >= 2303){
		count = 0;
		TIMER1_CTL_R = 0x00000000; // disable
	}
	
}

void Sound_Play(const uint8_t *pt, uint32_t count){
	 // reload value minus 1 because it starts at 0
		return;
}
